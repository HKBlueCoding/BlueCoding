<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
        
<mapper namespace="mapper.board">

	<resultMap id="boardResult" type="BoardVO">
	
		<result property="articleNO" column="articleNO" />
		<result property="boardTitle" column="boardTitle" />
		<result property="boardText" column="boardText" />
		<result property="boardDate" column="boardDate" />
		
		<result property="boardImage" column="boardImage" />
		<result property="bdViewCnt" column="bdViewCnt" />
		<result property="boardDelete" column="boardDelete" />
		<result property="id" column="id" />
		<result property="nick" column="nick" />
		
	</resultMap>

	<!-- [커뮤니티 게시글 조회]+페이징 -->
	<select id="selectAllBoardList" resultMap="boardResult" parameterType="hashMap">
	<![CDATA[
		SELECT 
		* 
		FROM 
			(
				SELECT 
					BD.*,
					ROWNUM AS RNUM 
				FROM
					(
						SELECT
							*
						FROM
							B_BOARD
						ORDER BY
							articleNO ASC
					) BD
			)
		WHERE 
			RNUM BETWEEN(#{section}-1)*100+(#{pageNum}-1)*10+1 AND (#{section}-1)*100+#{pageNum}*10

	]]>
	</select>

	<!-- [커뮤니티 게시글 추가] -->
	<insert id="insertArticle" parameterType="BoardVO">
	 <selectKey keyProperty="articleNO" resultType="int" order="BEFORE">
	 		SELECT MAX(ARTICLENO)+1 FROM B_BOARD
	 		</selectKey>
  			<![CDATA[
			INSERT INTO B_BOARD 
			(ARTICLENO, BOARDTITLE, BOARDTEXT, BOARDDATE, BOARDIMAGE, BDVIEWCNT, ID, NICK) 
			VALUES(#{articleNO}, #{boardTitle}, #{boardText}, sysdate, #{boardImage}, 0, #{id}, #{nick})
			]]>
	</insert>
	
	<!-- [커뮤니티 게시글 수정] -->	
	<select id="selectOneArticle" resultType="BoardVO" parameterType="int">
		<![CDATA[
		SELECT * FROM B_BOARD WHERE articleNO=#{articleNO}
		]]>
	</select>
	
	<update id="updateArticle" parameterType="BoardVO">
		<![CDATA[
		UPDATE B_BOARD SET BOARDTITLE=#{boardTitle}, BOARDTEXT=#{boardText}, BOARDIMAGE = #{boardImage}
		WHERE ARTICLENO=#{articleNO}
		]]>
	</update>

	<!-- [커뮤니티 게시글 삭제표시] -->		
	<update id="DeleteArticle">
		<![CDATA[
	UPDATE B_BOARD SET BOARDDELETE='Y'
	WHERE ARTICLENO=#{ARTICLENO}
		]]>	
	</update>
	
	<select id="selectArticleNO" resultType="int" parameterType="BoardVO">
	  <![CDATA[
		SELECT articleNO FROM B_BOARD 
		WHERE boardTitle = #{boardTitle} AND boardImage = #{boardImage} AND id=#{id}
	  ]]>	
	</select>
	
	<select id="selectTotArticle" resultType="int">
	 <![CDATA[
	  SELECT count(articleNO) FROM B_BOARD
	 ]]>
	</select>
	
</mapper>